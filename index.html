<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加权成绩计算程序</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            color: #4a90e2;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .section h2 {
            color: #4a90e2;
            font-size: 18px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e8f4fd;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-item {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }
        
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        .btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #357abd;
        }
        
        .btn-secondary {
            background-color: #50e3c2;
        }
        
        .btn-secondary:hover {
            background-color: #3ec8a7;
        }
        
        .btn-danger {
            background-color: #d0021b;
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .btn-danger:hover {
            background-color: #a50215;
        }
        
        .subject-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .subject-row input {
            flex: 1;
            min-width: 100px;
        }
        
        #subjects-container {
            margin-top: 20px;
        }
        
        #result {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 25px;
            margin-top: 20px;
            min-height: 300px;
            font-size: 16px;
            line-height: 1.8;
            overflow-y: auto;
        }
        
        .result-item {
            margin-bottom: 15px;
        }
        
        .highlight {
            color: #7ed321;
            font-weight: bold;
        }
        
        .warning {
            color: #f5a623;
            font-weight: bold;
        }
        
        .note {
            font-size: 12px;
            color: #666;
            margin-top: 20px;
            text-align: center;
            font-style: italic;
        }
        
        /* 响应式设计 */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-item {
                min-width: auto;
            }
            
            .subject-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .subject-row input {
                min-width: auto;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>加权成绩计算程序</h1>
        
        <!-- 基础信息输入区域 -->
        <div class="section">
            <h2>基础信息</h2>
            <div class="form-row">
                <div class="form-item">
                    <label for="currentGrade">当前加权平均分</label>
                    <input type="number" id="currentGrade" placeholder="例如：85.5" step="0.1">
                </div>
                <div class="form-item">
                    <label for="currentCredits">当前已获得总学分</label>
                    <input type="number" id="currentCredits" placeholder="例如：60" step="0.1">
                </div>
            </div>
            <div class="form-row">
                <div class="form-item">
                    <label for="targetGrade">目标加权平均分</label>
                    <input type="number" id="targetGrade" placeholder="例如：88.0" step="0.1">
                </div>
                <div class="form-item">
                    <label for="courseCredits">单门课程平均学分</label>
                    <input type="number" id="courseCredits" placeholder="例如：3" step="0.1">
                </div>
            </div>
        </div>
        
        <!-- 估分科目管理区域 -->
        <div class="section">
            <h2>估分科目</h2>
            <button class="btn btn-secondary" onclick="addSubject()">添加科目</button>
            <div id="subjects-container">
                <!-- 动态添加的科目将显示在这里 -->
            </div>
        </div>
        
        <!-- 计算和结果展示区域 -->
        <div class="section">
            <h2>计算结果</h2>
            <button class="btn" onclick="calculate()">确认计算</button>
            <div id="result">
                <!-- 计算结果将显示在这里 -->
            </div>
        </div>
        
        <div class="note">
            说明：输入基础信息后，添加需要估分的科目，填写分数和学分，点击计算按钮查看结果。
        </div>
    </div>
    
    <script>
        // 存储估分科目的列表
        let subjects = [];
        let subjectId = 0;
        
        // 添加估分科目的函数
        function addSubject() {
            subjectId++;
            
            const subject = {
                id: subjectId,
                score: '',
                credits: ''
            };
            
            subjects.push(subject);
            renderSubjects();
        }
        
        // 删除估分科目的函数
        function removeSubject(id) {
            subjects = subjects.filter(subject => subject.id !== id);
            renderSubjects();
        }
        
        // 渲染估分科目列表
        function renderSubjects() {
            const container = document.getElementById('subjects-container');
            container.innerHTML = '';
            
            subjects.forEach(subject => {
                const row = document.createElement('div');
                row.className = 'subject-row';
                row.innerHTML = `
                    <input type="number" placeholder="分数（例如：90）" step="0.1" 
                           onchange="updateSubject(${subject.id}, 'score', this.value)">
                    <input type="number" placeholder="学分（例如：3）" step="0.1" 
                           onchange="updateSubject(${subject.id}, 'credits', this.value)">
                    <button class="btn btn-danger" onclick="removeSubject(${subject.id})")">删除</button>
                `;
                container.appendChild(row);
            });
        }
        
        // 更新估分科目的值
        function updateSubject(id, field, value) {
            const subject = subjects.find(subject => subject.id === id);
            if (subject) {
                subject[field] = value;
            }
        }
        
        // 验证输入是否为有效数字
        function validateInput(value) {
            if (!value) {
                return false;
            }
            const num = parseFloat(value);
            return !isNaN(num);
        }
        
        // 计算函数
        function calculate() {
            // 获取并验证基础信息输入
            const currentGrade = document.getElementById('currentGrade').value;
            const currentCredits = document.getElementById('currentCredits').value;
            const targetGrade = document.getElementById('targetGrade').value;
            const courseCredits = document.getElementById('courseCredits').value;
            
            if (!validateInput(currentGrade)) {
                alert('请输入有效的当前加权平均分');
                return;
            }
            
            if (!validateInput(currentCredits)) {
                alert('请输入有效的当前已获得总学分');
                return;
            }
            
            // 验证目标分数和单门课程学分（可选）
            let targetGradeNum = null;
            let courseCreditsNum = null;
            
            if (validateInput(targetGrade)) {
                targetGradeNum = parseFloat(targetGrade);
                if (!validateInput(courseCredits)) {
                    alert('请输入有效的单门课程平均学分');
                    return;
                }
                courseCreditsNum = parseFloat(courseCredits);
            }
            
            // 转换为数字
            const currentGradeNum = parseFloat(currentGrade);
            const currentCreditsNum = parseFloat(currentCredits);
            
            // 验证估分科目输入
            const estimatedScores = [];
            const estimatedCredits = [];
            
            for (const subject of subjects) {
                if (!validateInput(subject.score)) {
                    alert('请输入有效的科目分数');
                    return;
                }
                
                if (!validateInput(subject.credits)) {
                    alert('请输入有效的科目学分');
                    return;
                }
                
                estimatedScores.push(parseFloat(subject.score));
                estimatedCredits.push(parseFloat(subject.credits));
            }
            
            // 计算总学分
            const totalCredits = currentCreditsNum + estimatedCredits.reduce((sum, credits) => sum + credits, 0);
            
            // 计算加权平均分
            const currentTotalScore = currentGradeNum * currentCreditsNum;
            const estimatedTotalScore = estimatedScores.reduce((sum, score, index) => sum + score * estimatedCredits[index], 0);
            const newGrade = (currentTotalScore + estimatedTotalScore) / totalCredits;
            
            // 计算误差区间
            const minEstimatedScores = estimatedScores.map(score => score - 3);
            const minEstimatedTotalScore = minEstimatedScores.reduce((sum, score, index) => sum + score * estimatedCredits[index], 0);
            const minGrade = (currentTotalScore + minEstimatedTotalScore) / totalCredits;
            
            const maxEstimatedScores = estimatedScores.map(score => score + 3);
            const maxEstimatedTotalScore = maxEstimatedScores.reduce((sum, score, index) => sum + score * estimatedCredits[index], 0);
            const maxGrade = (currentTotalScore + maxEstimatedTotalScore) / totalCredits;
            
            // 计算目标分数相关指标（如果有）
            let neededScore = null;
            let neededCourses = 0;
            
            if (targetGradeNum !== null) {
                const requiredTotalScore = targetGradeNum * totalCredits;
                const achievedTotalScore = currentTotalScore + estimatedTotalScore;
                neededScore = requiredTotalScore - achievedTotalScore;
                
                if (courseCreditsNum > 0 && neededScore > 0) {
                    const perCourseScore = 100 * courseCreditsNum;
                    neededCourses = Math.ceil(neededScore / perCourseScore);
                }
            }
            
            // 显示结果
            showResult(totalCredits, newGrade, minGrade, maxGrade, targetGradeNum, neededScore, neededCourses, courseCreditsNum);
        }
        
        // 显示结果函数
        function showResult(totalCredits, newGrade, minGrade, maxGrade, targetGrade, neededScore, neededCourses, courseCredits) {
            const resultDiv = document.getElementById('result');
            
            let resultHTML = `<div class="result-item"><strong>计算结果：</strong></div>`;
            resultHTML += `<div class="result-item">总学分：${totalCredits.toFixed(1)}</div>`;
            resultHTML += `<div class="result-item">新的加权平均分：${newGrade.toFixed(2)}</div>`;
            resultHTML += `<div class="result-item">平均分误差区间：[${minGrade.toFixed(2)}, ${maxGrade.toFixed(2)}]</div>`;
            resultHTML += `<div class="result-item" style="font-size: 12px; color: #666;">（基于每个估分科目±3分的合理波动范围）</div>`;
            
            // 目标分数相关结果（如果有）
            if (targetGrade !== null) {
                resultHTML += `<div class="result-item"><strong>目标加权平均分：${targetGrade.toFixed(2)}</strong></div>`;
                
                if (neededScore > 0) {
                    resultHTML += `<div class="result-item warning">还需分数：${neededScore.toFixed(2)}</div>`;
                    resultHTML += `<div class="result-item warning">对应 ${neededCourses} 门 ${courseCredits.toFixed(1)} 学分的课程</div>`;
                    resultHTML += `<div class="result-item" style="font-size: 12px; color: #666;">（假设每门课程都取得100分）</div>`;
                } else {
                    resultHTML += `<div class="result-item highlight">已达到或超过目标分数！</div>`;
                    resultHTML += `<div class="result-item highlight">超出分数：${Math.abs(neededScore).toFixed(2)}</div>`;
                }
            }
            
            resultDiv.innerHTML = resultHTML;
        }
    </script>
</body>
</html>